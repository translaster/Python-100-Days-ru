## Часто используемые структуры данных - словари

Мы уже познакомили вас с тремя контейнерными типами данных в Python (списками, кортежами и множествами), но их все равно недостаточно, чтобы решить все наши проблемы. Например, если нам нужна переменная для хранения нескольких частей информации о человеке, включая имя, возраст, рост, вес, домашний адрес, номер мобильного телефона человека и номер мобильного телефона контактного лица в экстренной ситуации, вы обнаружите, что ни один из типов списков, кортежей и множеств, которые мы изучали ранее, не подходит для этого.

```python
person1 = ['Ло Хао', 55, 168, 60, '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай', '13122334455', '13800998877']
person2 = ('Ло Хао', 55, 168, 60, '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай', '13122334455', '13800998877')
person3 = {'Ло Хао', 55, 168, 60, '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай', '13122334455', '13800998877'}
```

Множества, безусловно, являются наиболее подходящими, поскольку в них не может быть дублирующихся элементов; если возраст и вес человека совпадают, то в множестве будет на один элемент меньше информации; аналогично, если номер мобильного телефона человека и номер телефона для экстренной связи совпадают, то в множестве будет на один элемент меньше информации. С другой стороны, хотя списки и кортежи могут хранить всю информацию о человеке, когда вы хотите получить его номер мобильного телефона или домашний адрес, то нужно знать, сколько элементов в списке или кортеже занимает номер мобильного телефона человека. Короче говоря, когда речь идет об описанном выше сценарии, списки, кортежи и множества - не самые подходящие варианты. Нам нужен тип данных словарь, который лучше всего подходит для сборки связанной информации и может помочь нам решить проблему моделирования реальных вещей в программах на Python.

В Китае у детей в начальной школе, у каждого, как правило, есть под рукой копия словаря Синьхуа, как показано на следующем рисунке.

<img src="res/day13/xinhua_dictionary.jpg" style="zoom:80%;">

Словарь в программе на Python очень похож на реальный словарь, поскольку в нем данные организованы в пары ключ-значение (комбинации ключей и значений), и мы можем находить значения, соответствующие ключам, и манипулировать ими. Как и в словаре Синьхуа, каждое слово (ключ) имеет соответствующее ему объяснение (значение), каждое слово и его объяснение вместе - это запись в словаре, и словарь обычно содержит много таких записей.

### Создание и использование словарей

Создать словарь в Python можно с помощью синтаксиса литералов `{}`, который аналогичен множествам, о которых мы говорили в прошлом уроке. Но элементы в словаре `{}` имеют вид пар ключ-значение, каждая из которых состоит из двух значений, разделенных `:`, причем ключ находится перед `:`, а значение - после `:`, как показано в следующем коде.

```python
xinhua = {
    'foothills': 'подножие горы',
    'road': 'дорога, место для путешествия к месту и обратно',
    'leucaena': 'название для лакрицы',
    'Lu': 'Lu Shui, название воды, т.е. реки Тоужан в современной провинции Шаньси; Lu Jiang, название воды, т.е. реки Нуцзян в провинции Юньнань'
}
print(xinhua)
person = {
    'name': 'Ло Хао',
    'age': 55,
    'height': 168,
    'weight': 60,
    'addr': '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай', 
    'tel': '13122334455',
    'emergence contact': '13800998877'
}
print(person)
```

Как видно из приведенного выше кода, использование словаря для хранения информации о человеке намного лучше, чем использование списка или кортежа, поскольку мы должны использовать ключ перед `:` для обозначения понятия записи, а за `:` следует значение, соответствующее этой записи.

Конечно, при желании мы можем создать словарь с помощью встроенной функции `dict` или генеративного синтаксиса для словарей, как показано в приведенном ниже коде.

```python
# Каждый набор аргументов в функции dict (конструкторе) представляет собой набор пар ключ-значение в словаре
person = dict(name='Ло Хао', age=55, height=168, weight=60, addr='101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай')
print(person)  # {'name': 'Ло Хао', 'age': 55, 'height': 168, 'weight': 60, 'addr': '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай'}

# Вы можете использовать встроенную в Python функцию zip для двух последовательностей и создать словарь
items1 = dict(zip('ABCDE', '12345'))
print(items1)  # {'A': '1', 'B': '2', 'C': '3', 'D': '4', 'E': '5'}
items2 = dict(zip('ABCDE', range(1, 10)))
print(items2)  # {'A': 1, 'B': 2, 'C': 3, 'D': 4, 'E': 5}

# Создание словарей с помощью генеративного синтаксиса
items3 = {x: x ** 3 for x in range(1, 6)}
print(items3)  # {1: 1, 2: 8, 3: 27, 4: 64, 5: 125}
```

Чтобы узнать, сколько пар ключ-значение содержится в словаре, вы по-прежнему используете функцию `len`; для итерации по словарю можете использовать цикл `for`, но обратите внимание, что `for` просто итерирует по ключам словаря, но это не страшно; после изучения операций индексирования словаря мы можем получить доступ к значениям словаря по его ключам.

```python
person = {
    'name': 'Ло Хао',
    'age': 55,
    'height': 168,
    'weight': 60,
    'addr': '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай'
}
print(len(person))  # 5
for key in person:
    print(key)
```

### Операции над словарями

Для словарей, безусловно, важны операции принадлежности и индексации: первая определяет, есть ли указанный ключ в словаре, а вторая позволяет получить доступ к соответствующему значению через ключ или добавить в словарь новую пару ключ-значение. Стоит отметить, что индекс словаря отличается от индекса списка: элементы списка имеют свои порядковые номера, поэтому индекс списка - это целое число; словарь же хранит пары ключ-значение, поэтому для индексации соответствующего значения в словаре нужно использовать ключ. Важно обратить внимание на то, что **ключи в словаре должны быть неизменяемыми типами**, такими как целые числа (`int`), вещественные числа (`float`), строки (`str`), кортежи (`tuple`) и т.д., что совпадает с требованиями к типу элементов множества; очевидно, что списки (`list`), о которых мы говорили, и множества (`set`) не могут быть использованы в качестве ключа в словаре, поскольку словари также являются изменяемыми типами, но списки, множества и словари могут быть использованы в качестве значений в словаре, например:

```python
person = {
    'name': 'Ло Хао',
    'age': 55,
    'height': 168,
    'weight': 60,
    'addr': ['101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай', 'No.1, проспект Миллион Чжуан, район Сичэн, Пекин'],
    'car': {
        'brand': 'BMW X7',
        'maxSpeed': '250',
        'length': 5170,
        'width': 2000,
        'height': 1835,
        'displacement': 3.0
    }
}
print(person)
```

Вы можете взглянуть на следующий код, чтобы понять операции принадлежности и индексирования словарей.

```python
person = {'name': 'Ло Хао', 'age': 55, 'height': 168, 'weight': 60, 'addr': '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай'}

# Принадлежность
print('name' in person)  # True
print('tel' in person)   # False

# Операция индексирования
print(person['name'])
print(person['addr'])
person['age'] = 25
person['height'] = 178
person['tel'] = '13122334455'
person['signature'] = 'Ваш парень - такой гайдзин, что готов пройтись по разноцветным облакам, чтобы жениться на вашей лучшей подруге.'
print(person)

# Циклический перебор
for key in person:
    print(f'{key}:\t{person[key]}')
```

Обратите внимание, что при получении значения из словаря через индексацию, если указанного ключа нет в словаре, будет выброшено исключение `KeyError`.

### Методы словаря

Методы словаря в основном связаны с операциями над парами ключ-значение в словаре, где метод `get` может получить значение по ключу. В отличие от операций индексирования, метод `get` не выбрасывает исключение, если в словаре нет указанного ключа, а возвращает `None` или указанное значение по умолчанию, как показано в следующем коде.

```python
person = {'name': 'Ло Хао', 'age': 25, 'height': 178, 'addr': '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай'}
print(person.get('name'))       # Ло Хао
print(person.get('sex'))        # None
print(person.get('sex', True))  # True
```

如果需要获取字典中所有的键，可以使用`keys`方法；如果需要获取字典中所有的值，可以使用`values`方法。字典还有一个名为`items`的方法，它会将键和值组装成二元组，通过该方法来遍历字典中的元素也是非常方便的。

```python
person = {'name': 'Ло Хао', 'age': 25, 'height': 178}
print(person.keys())    # dict_keys(['name', 'age', 'height'])
print(person.values())  # dict_values(['Ло Хао', 25, 178])
print(person.items())   # dict_items([('name', 'Ло Хао'), ('age', 25), ('height', 178)])
for key, value in person.items():
    print(f'{key}:\t{value}')
```

字典的`update`方法实现两个字典的合并操作。例如，有两个字典`x`和`y`，当执行`x.update(y)`操作时，`x`跟`y`相同的键对应的值会被`y`中的值更新，而`y`中有但`x`中没有的键值对会直接添加到`x`中，代码如下所示。

```python
person1 = {'name': 'Ло Хао', 'age': 55, 'height': 178}
person2 = {'age': 25, 'addr': '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай'}
person1.update(person2)
print(person1)  # {'name': 'Ло Хао', 'age': 25, 'height': 178, 'addr': '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай'}
```

如果使用 Python 3.9 及以上的版本，也可以使用`|`运算符来完成同样的操作，代码如下所示。

```python
person1 = {'name': 'Ло Хао', 'age': 55, 'height': 178}
person2 = {'age': 25, 'addr': '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай'}
person1 |= person2
print(person1)  # {'name': 'Ло Хао', 'age': 25, 'height': 178, 'addr': '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай'}
```

可以通过`pop`或`popitem`方法从字典中删除元素，前者会返回（获得）键对应的值，但是如果字典中不存在指定的键，会引发`KeyError`错误；后者在删除元素时，会返回（获得）键和值组成的二元组。字典的`clear`方法会清空字典中所有的键值对，代码如下所示。

```python
person = {'name': 'Ло Хао', 'age': 25, 'height': 178, 'addr': '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай'}
print(person.pop('age'))  # 25
print(person)             # {'name': 'Ло Хао', 'height': 178, 'addr': '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай'}
print(person.popitem())   # ('addr', '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай')
print(person)             # {'name': 'Ло Хао', 'height': 178}
person.clear()
print(person)             # {}
```

跟列表一样，从字典中删除元素也可以使用`del`关键字，在删除元素的时候如果指定的键索引不到对应的值，一样会引发`KeyError`错误，具体的做法如下所示。

```python
person = {'name': 'Ло Хао', 'age': 25, 'height': 178, 'addr': '101, здание 1, № 62 Kehua North Road, район Ухоу, Чэнду, Китай'}
del person['age']
del person['addr']
print(person)  # {'name': 'Ло Хао', 'height': 178}
```

### 字典的应用

我们通过几个简单的例子来看看如何使用字典类型解决一些实际的问题。

**例子1**：输入一段话，统计每个英文字母出现的次数，按出现次数从高到低输出。

```python
sentence = input('请输入一段话: ')
counter = {}
for ch in sentence:
    if 'A' <= ch <= 'Z' or 'a' <= ch <= 'z':
        counter[ch] = counter.get(ch, 0) + 1
sorted_keys = sorted(counter, key=counter.get, reverse=True)
for key in sorted_keys:
    print(f'{key} 出现了 {counter[key]} 次.')
```

输入：

```
Man is distinguished, not only by his reason, but by this singular passion from other animals, which is a lust of the mind, that by a perseverance of delight in the continued and indefatigable generation of knowledge, exceeds the short vehemence of any carnal pleasure.
```

输出：

```
e 出现了 27 次.
n 出现了 21 次.
a 出现了 18 次.
i 出现了 18 次.
s 出现了 16 次.
t 出现了 16 次.
o 出现了 14 次.
h 出现了 13 次.
r 出现了 10 次.
d 出现了 9 次.
l 出现了 9 次.
g 出现了 6 次.
u 出现了 6 次.
f 出现了 6 次.
c 出现了 6 次.
y 出现了 5 次.
b 出现了 5 次.
m 出现了 4 次.
p 出现了 3 次.
w 出现了 2 次.
v 出现了 2 次.
M 出现了 1 次.
k 出现了 1 次.
x 出现了 1 次.
```

**例子2**：在一个字典中保存了股票的代码和价格，找出股价大于100元的股票并创建一个新的字典。

> **说明**：可以用字典的生成式语法来创建这个新字典。

```python
stocks = {
    'AAPL': 191.88,
    'GOOG': 1186.96,
    'IBM': 149.24,
    'ORCL': 48.44,
    'ACN': 166.89,
    'FB': 208.09,
    'SYMC': 21.29
}
stocks2 = {key: value for key, value in stocks.items() if value > 100}
print(stocks2)
```

输出：

```
{'AAPL': 191.88, 'GOOG': 1186.96, 'IBM': 149.24, 'ACN': 166.89, 'FB': 208.09}
```

### 总结

Python 程序中的字典跟现实生活中字典非常像，允许我们**以键值对的形式保存数据**，再**通过键访问对应的值**。字典是一种非常**有利于数据检索**的数据类型，但是需要再次提醒大家，**字典中的键必须是不可变类型**，列表、集合、字典等类型的数据都不能作为字典的键。
